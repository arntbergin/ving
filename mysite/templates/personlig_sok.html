{% extends "base.html" %}

{% block content %}

<div class="mb-3 s√∏k-boks"> 
<h2 class="mb-3">
    Legg til personlig s√∏k
    <a href="https://www.ving.no/bestill-reise?CategoryId=2&QueryAreaID=0&QueryCtryID=4328&QueryDepDate=20260428&QueryDepID=12672&QueryDur=8&QueryResID=4345&QueryRoomAges=%7C42&QueryUnits=1&experiments=test%3Ab%2Cuniversalhotelcard%3Aold%2Cnamecollectionpopup%3Aold%2Ccharterflowhotelcard%3Aabovefold&firstDisplayed=-1&nrOfHotels=10&selectedTransport=flight%7CCgJWThIkMjljNzMyZDItMTAzYi00MDc1LWJiOTctYjVkYjk2OWZjYmVi" 
    class="btn btn-secondary" target="_blank">
        Eksempel
    </a>
</h2>

<form method="post" class="mb-4">
    {% csrf_token %}
        <input type="text" name="navn" class="form-control" placeholder="Navn p√• s√∏ket" required>
        <input type="url" name="url" id="url-input" class="form-control" placeholder="Lim inn URL her" required>
        <div class="mb-3"></div>
        <button type="button" class="btn btn-info" id="test-knapp">Test URL</button>
        <span id="test-resultat" class="ms-2 small"></span>
    <button type="submit" class="btn btn-secondary">Lagre</button>
</form>

<h3>Dine lagrede URL-er</h3>
{% if mine_urler %}
    <ul class="list-group">
        {% for item in mine_urler %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                    <strong>{{ item.navn }}</strong><br>
                    <small class="text-muted">Lagt til {{ item.lagt_til|date:"d.m.Y H:i" }}</small>
                </div>
                <form method="post" action="{% url 'slett_personlig_url' item.id %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-outline-danger">Slett</button>
                </form>
            </li>
        {% endfor %}
    </ul>
{% else %}
    <div class="alert alert-info mt-3">Ingen URL-er lagret enn√•.</div>
{% endif %}
</div>

<script>
document.getElementById("test-knapp").addEventListener("click", () => {
    const url = document.getElementById("url-input").value;
    const resultat = document.getElementById("test-resultat");

    if (!url) {
        resultat.textContent = "‚ùå Du m√• fylle inn en URL";
        resultat.className = "text-danger small";
        return;
    }

    resultat.textContent = "üîÑ Tester...";
    resultat.className = "text-muted small";

    fetch(`/test-ving-url/?url=${encodeURIComponent(url)}`)
      .then(res => res.json())
      .then(data => {
        console.log("Response:", data); //sjekk respons
        if (data.ok) {
          resultat.textContent = `‚úÖ Test ok`;
          resultat.className = "text-success small";
        } else {
          resultat.textContent = `‚ùå ${data.error}`;
          resultat.className = "text-danger small";
        }
      })
      .catch(() => {
        resultat.textContent = "‚ùå Feil ved testing";
        resultat.className = "text-danger small";
      });
});
</script>
{% endblock %}
